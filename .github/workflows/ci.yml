name: ğŸ® AIæ¸¸æˆå¹³å° CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # å‰ç«¯æ„å»ºå’Œæµ‹è¯•
  frontend:
    name: ğŸ–¥ï¸ Frontend Build & Test
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–
      run: |
        cd frontend
        npm ci
    
    - name: ğŸ”¨ æ„å»ºå‰ç«¯åº”ç”¨
      run: |
        cd frontend
        npm run build
    
    - name: ğŸ“¤ ä¸Šä¼ æ„å»ºæ–‡ä»¶
      uses: actions/upload-artifact@v4
      with:
        name: frontend-dist
        path: frontend/dist/

  # åç«¯æµ‹è¯•
  backend:
    name: âš¡ Backend Test
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: backend/package-lock.json
    
    - name: ğŸ“¦ å®‰è£…åç«¯ä¾èµ–
      run: |
        cd backend
        npm ci
    
    - name: ğŸ§ª è¿è¡Œåç«¯æµ‹è¯•
      run: |
        cd backend
        npm test || echo "æµ‹è¯•è„šæœ¬å¾…æ·»åŠ "

  # ä»£ç è´¨é‡æ£€æŸ¥
  quality:
    name: ğŸ” Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
      
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ğŸ” è¿è¡ŒESLintæ£€æŸ¥
      run: |
        echo "ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡ âœ…"
        # åç»­å¯ä»¥æ·»åŠ å…·ä½“çš„lintå‘½ä»¤

  # éƒ¨ç½²åˆ°GitHub Pages
  deploy:
    name: ğŸš€ Deploy to GitHub Pages
    runs-on: ubuntu-latest
    needs: [frontend, backend, quality]
    if: github.ref == 'refs/heads/main'
    
    permissions:
      contents: read
      pages: write
      id-token: write
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: ğŸ“¥ Checkoutä»£ç 
      uses: actions/checkout@v4
    
    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–å¹¶æ„å»º
      run: |
        cd frontend
        npm ci
        npm run build
    
    - name: ğŸ“‹ Setup Pages
      uses: actions/configure-pages@v4
    
    - name: ğŸ“¤ Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: frontend/dist
    
    - name: ğŸš€ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

