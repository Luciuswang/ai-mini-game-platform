<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上海麻将</title>
    <!-- 字体和图标 -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 访客计数器 -->
    <script src="../../visitor-counter.js"></script>
    <style>
        body { margin:0; padding:20px; background:#2e7d32; color:#fff; font-family:Arial; }
        .container { text-align:center; max-width:800px; margin:0 auto; }
        .title { font-size:3rem; color:#ffd700; margin-bottom:20px; }
        .subtitle { font-size:1.2rem; margin-bottom:30px; }
        .start-btn { 
            padding:15px 30px; font-size:1.2rem; background:#ff5722; 
            color:white; border:none; border-radius:10px; cursor:pointer; 
            margin:10px; transition:all 0.3s;
        }
        .start-btn:hover { background:#d84315; transform:translateY(-2px); }
        .game-area { display:none; margin-top:30px; }
        .mahjong-table { 
            background:#4a7c59; border:5px solid #8d6e63; border-radius:15px; 
            padding:20px; margin:20px auto; min-height:400px; position:relative;
        }
        .player-hand { display:flex; gap:5px; justify-content:center; flex-wrap:wrap; margin:20px 0; }
        .tile { 
            width:40px; height:60px; background:#f5f5f5; border:2px solid #bbb; 
            border-radius:5px; display:flex; align-items:center; justify-content:center; 
            font-weight:bold; color:#333; cursor:pointer; transition:all 0.2s;
        }
        .tile:hover { transform:translateY(-3px); border-color:#ff5722; }
        .tile.selected { transform:translateY(-8px); border-color:#ff5722; background:#ffe0b2; }
        .controls { margin:20px 0; }
        .control-btn { 
            padding:10px 20px; margin:5px; background:#4caf50; color:white; 
            border:none; border-radius:5px; cursor:pointer; font-size:14px;
        }
        .control-btn:disabled { background:#666; cursor:not-allowed; }
        .info { font-size:1.1rem; margin:10px 0; }
        .message { 
            position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); 
            background:rgba(0,0,0,0.9); padding:20px; border-radius:10px; 
            border:2px solid #ff5722; display:none; z-index:1000;
        }
        @media (max-width:768px) { 
            .tile { width:32px; height:48px; font-size:12px; }
            .title { font-size:2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="startScreen">
            <h1 class="title"> 上海麻将</h1>
            <p class="subtitle">正宗本帮麻将，与AI对战<br>点击牌选择，再点击打出，目标七对子胡牌！</p>
            <button class="start-btn" onclick="startGame()">开始游戏</button>
        </div>

        <div id="gameArea" class="game-area">
            <div class="info">
                <span>当前玩家: <span id="currentPlayer">玩家</span></span> | 
                <span>剩余牌: <span id="remainingTiles">112</span></span> | 
                <span>分数: <span id="score">0</span></span>
            </div>
            
            <div class="mahjong-table">
                <div class="info"> 上海麻将桌</div>
                <div class="player-hand" id="playerHand"></div>
                <div class="controls">
                    <button class="control-btn" onclick="drawTile()">摸牌</button>
                    <button class="control-btn" id="discardBtn" onclick="discardTile()" disabled>打牌</button>
                    <button class="control-btn" onclick="checkWin()">胡牌</button>
                    <button class="control-btn" onclick="restart()">重开</button>
                </div>
            </div>
        </div>
    </div>

    <div id="message" class="message"></div>

    <script>
        const tiles = ['1万','2万','3万','4万','5万','6万','7万','8万','9万',
                      '1筒','2筒','3筒','4筒','5筒','6筒','7筒','8筒','9筒',
                      '1条','2条','3条','4条','5条','6条','7条','8条','9条',
                      '东','南','西','北','中','发','白'];
        
        let deck = [];
        let playerHand = [];
        let selectedTile = -1;
        let score = 0;
        let gameRunning = false;

        function createDeck() {
            deck = [];
            tiles.forEach(tile => {
                for(let i = 0; i < 4; i++) deck.push(tile);
            });
            // 花牌
            ['春','夏','秋','冬'].forEach(flower => deck.push(flower));
            shuffle(deck);
        }

        function shuffle(array) {
            for(let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            
            createDeck();
            playerHand = [];
            selectedTile = -1;
            score = 0;
            gameRunning = true;
            
            // 发13张牌
            for(let i = 0; i < 13; i++) {
                if(deck.length > 0) playerHand.push(deck.pop());
            }
            
            updateDisplay();
            showMessage('游戏开始！点击摸牌开始游戏', 2000);
        }

        function updateDisplay() {
            const handDiv = document.getElementById('playerHand');
            handDiv.innerHTML = '';
            
            playerHand.forEach((tile, index) => {
                const tileDiv = document.createElement('div');
                tileDiv.className = 'tile' + (selectedTile === index ? ' selected' : '');
                tileDiv.textContent = tile;
                tileDiv.onclick = () => selectTile(index);
                handDiv.appendChild(tileDiv);
            });
            
            document.getElementById('remainingTiles').textContent = deck.length;
            document.getElementById('score').textContent = score;
        }

        function selectTile(index) {
            if(!gameRunning) return;
            
            if(selectedTile === index) {
                // 再次点击同一张牌，打出
                discardTile();
            } else {
                selectedTile = index;
                updateDisplay();
                document.getElementById('discardBtn').disabled = false;
            }
        }

        function drawTile() {
            if(!gameRunning || deck.length === 0) return;
            
            const newTile = deck.pop();
            playerHand.push(newTile);
            
            updateDisplay();
            showMessage('摸到了: ' + newTile, 1000);
            
            // 检查花牌
            if(['春','夏','秋','冬'].includes(newTile)) {
                showMessage('摸到花牌！再摸一张', 1500);
                setTimeout(() => drawTile(), 1000);
            }
        }

        function discardTile() {
            if(!gameRunning || selectedTile === -1) return;
            
            const discarded = playerHand.splice(selectedTile, 1)[0];
            selectedTile = -1;
            
            updateDisplay();
            showMessage('打出了: ' + discarded, 1000);
            document.getElementById('discardBtn').disabled = true;
        }

        function checkWin() {
            if(!gameRunning || playerHand.length !== 14) {
                showMessage('需要14张牌才能胡牌！', 2000);
                return;
            }
            
            // 检查七对子
            const counts = {};
            playerHand.forEach(tile => {
                counts[tile] = (counts[tile] || 0) + 1;
            });
            
            const pairs = Object.values(counts).filter(count => count === 2);
            
            if(pairs.length === 7) {
                score += 20;
                showMessage(' 恭喜！七对子胡牌！\n获得20分！', 0);
                gameRunning = false;
            } else {
                showMessage('还不能胡牌，继续努力！', 2000);
            }
        }

        function restart() {
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
            gameRunning = false;
        }

        function showMessage(text, duration = 3000) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.style.display = 'block';
            
            if(duration > 0) {
                setTimeout(() => msg.style.display = 'none', duration);
            }
        }

        // 键盘控制
        document.addEventListener('keydown', (e) => {
            if(!gameRunning) return;
            if(e.code === 'Space' && selectedTile !== -1) {
                e.preventDefault();
                discardTile();
            }
        });
    </script>
</body>
</html>
